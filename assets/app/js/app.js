(function($){$(document).ready(function(){let tfhb_local_timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone;const tfhb_i18n=tfhb_app_booking.i18n;tfhb_local_timeZone=="Asia/Calcutta"&&(tfhb_local_timeZone="Asia/Kolkata");function tfhbTranslate(t){return tfhb_i18n[t]||t+"not found"}function tfhbTranslateNumber(t){return t.toString().split("").map(function(e){return tfhbTranslate(e)}).join("")}function tfhbTranslateTimeSlot(t){return t.slice(6,8)!=""?tfhbTranslateNumber(t.slice(0,2))+":"+tfhbTranslateNumber(t.slice(3,5))+" "+tfhbTranslate(t.slice(6,8)):tfhbTranslateNumber(t.slice(0,2))+":"+tfhbTranslateNumber(t.slice(3,5))}$(document).on("click",".tfhb-timezone-tabs ul li",function(t){$(".tfhb-timezone-tabs ul li").removeClass("active");var e=$(this);e.addClass("active")}),$(".tfhb-meeting-box").each(function(){let $this=$(this),calenderId=$this.attr("data-calendar"),calenderData=eval("tfhb_app_booking_"+calenderId),preloader=`<div class="tfhb-preloader"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-linecap="round" fill="none" stroke-dasharray="51.83627878423159 51.83627878423159" stroke="#2e6b38" stroke-width="4" r="33" cy="50" cx="50">
				<animateTransform values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
			  </circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg></span></div>`,date=new Date,year=date.getFullYear(),month=date.getMonth();const tfhb_calendar_navs=$this.find(".tfhb-calendar-navigation span"),months=["January","February","March","April","May","June","July","August","September","October","November","December"];tfhb_date_manipulate($this,calenderData,year,month,date,months),tfhb_calendar_navs.each(function(){$(this).on("click",function(){month=$(this).attr("id")==="tfhb-calendar-prev"?month-1:month+1,month<0||month>11?(date=new Date(year,month,new Date().getDate()),year=date.getFullYear(),month=date.getMonth()):date=new Date,$this.find(".tfhb-meeting-times").animate({left:"-50%",width:0,opacity:0},300,function(){$(this).css("display","none")}),tfhb_date_manipulate($this,calenderData,year,month,date,months);var t=new Date(year,month,2).toISOString().split("T")[0];setTimeout(function(){tfhb_times_manipulate($this,t,calenderData)},1e3)})}),$($this).on("click",".tfhb-calendar-dates li",function(t){var e=$(this);if(e.hasClass("inactive"))return!1;$this.find(".tfhb-meeting-times").css("display","block").animate({left:"0%",opacity:1,width:224},400),$this.find(".tfhb-available-times").removeClass("inactive"),$this.find(".tfhb-available-times").html(""),$this.find(".tfhb-available-times").append("<ul></ul>");var a=e.attr("data-date");$this.find("#meeting_dates").val(a);var n=tfhbTranslate(new Date(a).toLocaleDateString("en-US",{weekday:"long"})),r=tfhbTranslate(new Date(a).toLocaleDateString("en-US",{month:"long"})),l=tfhbTranslateNumber(new Date(a).toLocaleDateString("en-US",{day:"numeric"})),c=n+", "+r+" "+l;$this.find(".tfhb-meeting-times .tfhb-select-date").html(c);var o=calenderData.calander_available_time_slot[a];if(o.length>0)for(var s=0;s<o.length;s++){var d="";o[s].remaining!=null&&(d='<span class="tfhb-time-slot-remaining tfhb-flexbox"><span></span>'+tfhbTranslateNumber(o[s].remaining)+" "+tfhbTranslate("seats left")+"</span>"),$this.find(".tfhb-available-times ul").append('<li class="tfhb-flexbox"> <div class="time" data-time-start="'+o[s].start+'" data-time-end="'+o[s].end+'">'+tfhbTranslateTimeSlot(o[s].start)+d+" </div> </li>")}else $this.find(".tfhb-available-times ul").append('<li class="tfhb-flexbox"> <div>No time slot available in this date ! Try another date.</span> </div>');$this.find(".tfhb-calendar-dates li").removeClass("active"),e.addClass("active")}),$this.find("#attendee_time_zone_"+calenderId).on("change",function(t){$this.find(".tfhb-meeting-times").animate({left:"-50%",width:0,opacity:0},300,function(){$(this).css("display","none")});var e=new Date(year,month,2).toISOString().split("T")[0];tfhb_times_manipulate($this,e,calenderData)}),$this.find('input[name="tfhb_time_format"]').on("change",function(t){var e=new Date(year,month,2).toISOString().split("T")[0];tfhb_times_manipulate($this,e,calenderData,function(){$this.find(".tfhb-calendar-dates li.active").trigger("click")})});const $timezoneSelect=$this.find("#attendee_time_zone_"+calenderId);$timezoneSelect.length&&($timezoneSelect.select2({dropdownCssClass:"tfhb-select2-dropdown"}),$timezoneSelect.val(tfhb_local_timeZone).trigger("change")),$($this).on("click",".tfhb-available-times li .time",function(t){$this_time=$(this),$(".tfhb-available-times li .time").removeClass("active"),$(".tfhb-available-times li .next").remove();var e=$this_time.attr("data-time-start"),a=$this_time.attr("data-time-end");$this.find("input[name='meeting_time_start']").val(e),$this.find("input[name='meeting_time_end']").val(a),$this_time.parent().append('<span class="next tfhb-flexbox tfhb-gap-8"> '+tfhbTranslate("Next")+'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 10L14 10" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 4.16666L14.8333 9.99999L9 15.8333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>'),$this_time.addClass("active")}),$($this).on("click",".tfhb-available-times li .next",function(t){var e=$this.find("#attendee_time_zone_"+calenderId).val(),a=$this.find("#meeting_dates").val(),n=$this.find("#meeting_time_start").val();$this.find("#meeting_time_end").val();var r=`<li class="tfhb-flexbox tfhb_time_zone_info tfhb-gap-8">
						<input type="hidden" id="recurring_maximum" name="recurring_maximum" value="' . esc_attr( $meeting['recurring_maximum'] ) . '">
						<div class="tfhb-icon">  
							<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
								<g clip-path="url(#clip0_1840_26071)">
									<path d="M8.00065 14.6667C11.6825 14.6667 14.6673 11.6819 14.6673 8.00001C14.6673 4.31811 11.6825 1.33334 8.00065 1.33334C4.31875 1.33334 1.33398 4.31811 1.33398 8.00001C1.33398 11.6819 4.31875 14.6667 8.00065 14.6667Z" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M8.00065 1.33334C6.28881 3.13078 5.33398 5.51784 5.33398 8.00001C5.33398 10.4822 6.28881 12.8692 8.00065 14.6667C9.71249 12.8692 10.6673 10.4822 10.6673 8.00001C10.6673 5.51784 9.71249 3.13078 8.00065 1.33334Z" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M1.33398 8H14.6673" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									</g>
									<defs>
									<clipPath id="clip0_1840_26071">
									<rect width="16" height="16" fill="white"/>
									</clipPath>
									</defs>
							</svg>
						</div> 
						<div>
							`+e+"("+tfhbTranslateTimeSlot(n)+`)
						</div>
					</li>`,l=new Date(a),c=tfhbTranslate(l.toLocaleDateString("en-US",{weekday:"long"})),o=tfhbTranslate(l.toLocaleDateString("en-US",{month:"long"})),s=tfhbTranslateNumber(l.toLocaleDateString("en-US",{day:"numeric"})),d=tfhbTranslateNumber(l.toLocaleDateString("en-US",{year:"numeric"})),m=c+", "+o+" "+s+", "+d,u=`<li class="tfhb-flexbox tfhb_date_time_info tfhb-gap-8">
						<input type="hidden" id="recurring_maximum" name="recurring_maximum" value="' . esc_attr( $meeting['recurring_maximum'] ) . '">
						<div class="tfhb-icon">  
							<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M5.33398 1.33334V4.00001" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M10.666 1.33334V4.00001" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M12.6667 2.66666H3.33333C2.59695 2.66666 2 3.26361 2 3.99999V13.3333C2 14.0697 2.59695 14.6667 3.33333 14.6667H12.6667C13.403 14.6667 14 14.0697 14 13.3333V3.99999C14 3.26361 13.403 2.66666 12.6667 2.66666Z" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M2 6.66666H14" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M6 10.6667L7.33333 12L10 9.33334" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</div> 
						<div>
							`+m+`
						</div>
					</li>`;$this.find(".tfhb-meeting-details ul").append(r),$this.find(".tfhb-meeting-details ul").append(u),$this.find(".tfhb-timezone").hide(),$this.find(".tfhb-meeting-times").animate({left:"-50%",width:0,opacity:0},300,function(){$(this).css("display","none")}),$this.find(".tfhb-calander-times").animate({left:"-5%",opacity:0},400,function(){$(this).css("display","none"),$this.find(".tfhb-meeting-booking-form").css("display","block").animate({left:"0",opacity:1,width:536},300)})}),$("span.tfhb-see-description").on("click",function(){$(".tfhb-short-description").slideUp(),$(".tfhb-full-description").slideDown()}),$("span.tfhb-see-less-description").on("click",function(){$(".tfhb-full-description").slideUp(),$(".tfhb-short-description").slideDown()}),$($this).on("click",".tfhb-meeting-booking-form .tfhb-back-btn",function(t){$this.find(".tfhb-meeting-booking-form").animate({left:"-5%",opacity:0},300,function(){$(this).css("display","none"),$this.find(".tfhb-timezone").show(),$this.find(".tfhb-calander-times").css("display","flex").animate({left:"0",opacity:1},200,function(){}),$this.find(".tfhb-meeting-times").css("display","block").animate({left:"0",width:224},400,function(){$(this).css("opacity","1"),$this.find(".tfhb-meeting-details ul .tfhb_time_zone_info").remove(),$this.find(".tfhb-meeting-details ul .tfhb_date_time_info").remove()})})}),$this.find(".tfhb-meeting-form.ajax-submit").on("submit",function(t){t.preventDefault();var e=new FormData(this),a={};e.forEach(function(n,r){a[r]=n}),tfhb_from_submission($this,preloader,a,calenderData)}),document.addEventListener("wpcf7mailsent",function(t){var e=t.detail.formData,a={};e.forEach(function(n,r){a[r]=n}),tfhb_from_submission($this,preloader,a,calenderData)}),$(document).on("forminator:form:submit:success",function(t,e){var a={};e.forEach(function(n,r){a[r]=n}),tfhb_from_submission($this,preloader,a,calenderData)}),$(document).on("fluentform_submission_success",function(t,e){var a=new FormData(e.form[0]),n={};a.forEach(function(r,l){n[l]=r}),tfhb_from_submission($this,preloader,n,calenderData)})});function tfhb_render_paypal_payment(t,e){t.find(".tfhb-paypal-button-container");var a=e.confirmation_template;t.find(".tfhb-confirmation-button").hide(),t.find(".wpcf7").hide();let n=typeof tfhb_app_booking.general_settings.currency<"u"&&tfhb_app_booking.general_settings.currency!=""?tfhb_app_booking.general_settings.currency:"USD";paypal.Buttons({createOrder:function(r,l){return l.order.create({purchase_units:[{reference_id:e.data.attendee_data.id,description:e.data.meeting.title+" - "+e.data.meeting.duration+" Minutes | "+e.data.booking.start_time+" - "+e.data.booking.end_time+" | "+e.data.booking.meeting_dates,custom_id:e.data.attendee_data.id,amount:{currency_code:n,value:e.data.meeting.meeting_price}}]})},onApprove:function(r,l){return l.order.capture().then(function(c){$.ajax({url:tfhb_app_booking.ajax_url,type:"POST",data:{nonce:tfhb_app_booking.nonce,action:"tfhb_meeting_paypal_payment_confirmation",payment_details:c,responseData:e},success:function(o){o.success?(t.find(".tfhb-meeting-card").html(""),t.find(".tfhb-meeting-card").append(a)):(t.find(".tfhb-notice").html(o.data.message),t.find(".tfhb-notice").show())},error:function(o){console.log(o)}})})},onCancel:function(r){},onError:function(r){console.error("An error occurred during the transaction",r),alert("Payment could not be completed due to an error")}}).render(".tfhb-paypal-button-container")}function tfhb_render_stripe_payment(t,e,a,n){t.find(".tfhb-confirmation-button").hide();let r=typeof tfhb_app_booking.general_settings.currency<"u"&&tfhb_app_booking.general_settings.currency!=""?tfhb_app_booking.general_settings.currency:"USD";t.find(".wpcf7").hide();const l=t.find(".tfhb-stripe-button-container");l.html("<a href='#' class='tfhb-stripe-payment-btn'>Pay With Stripe</a>"),l.show();var c=e.confirmation_template;const o=StripeCheckout.configure({key:a,locale:"auto",token:function(s){const d={tokenId:s.id};jQuery.ajax({url:tfhb_app_booking.ajax_url,type:"POST",data:{nonce:tfhb_app_booking.nonce,action:"tfhb_meeting_stripe_payment_confirmation",payment_data:d,responseData:e},beforeSend:function(m){$(".tfhb-stripe-payment-btn").append(`<span class="tfhb-submit-preloader"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="188.49555921538757 64.83185307179586" r="40" stroke-width="4" stroke="#ffffff" fill="none" cy="50" cx="50">
							<animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="0.49751243781094534s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
						</circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg><span>`),$(".tfhb-stripe-payment-btn").addClass("disabled")},success:function(m){m.success?(t.find(".tfhb-meeting-card").html(""),t.find(".tfhb-meeting-card").append(c)):(t.find(".tfhb-notice").html(m.data.message),t.find(".tfhb-notice").show())},error:function(m){console.error("Payment processing error:",m)}})}});l.on("click",".tfhb-stripe-payment-btn",function(s){s.preventDefault(),o.open({name:n,amount:e.data.meeting.meeting_price*100,currency:r})}),window.addEventListener("popstate",function(){o.close()})}function tfhb_from_submission(t,e,a,n){t.find(".tfhb-booking-submit").append(`<span class="tfhb-submit-preloader"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="188.49555921538757 64.83185307179586" r="40" stroke-width="4" stroke="#ffffff" fill="none" cy="50" cx="50">
			<animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="0.49751243781094534s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
		  </circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg><span>`),t.find(".tfhb-booking-submit").attr("disabled","disabled"),t.find(".tfhb-notice").hide(),t.find(".tfhb-notice").html("");var l=t.find(".tfhb-meeting-details h2").text(),c=t.find("#meeting_id").val(),o=t.find("#host_id").val(),s=t.find("#meeting_duration").val(),d=t.find("#meeting_dates").val(),m=t.find("#meeting_time_start").val(),u=t.find("#meeting_time_end").val(),p=t.find("#booking_hash").val(),C=t.find("#action_type").val(),v=t.find("#meeting_price").val(),j=t.find("#recurring_maximum").val(),M=t.find("#attendee_time_zone_"+n.meeting_id).val(),w=t.find("#tfhb_time_format").val();t.find("#name").val(),t.find("#email").val(),t.find("#address").val();var h=t.find("#payment_method").val(),v=t.find("#meeting_price").val(),N=t.find("#payment_amount").val(),b=t.find("#stpublic_key").val();t.find("#paypal_public_key").val();var x=t.find("#payment_currency").val(),_=n.payment_status,y={action:"tfhb_meeting_form_submit",nonce:tfhb_app_booking.nonce,meeting_id:c,host_id:o,meeting_dates:d,meeting_duration:s,meeting_time_start:m,meeting_time_end:u,booking_hash:p,action_type:C,recurring_maximum:j,attendee_time_zone:M,tfhb_time_format:w,payment_type:h,meeting_price:v,payment_amount:N,stripe_public_key:b,payment_currency:x};y=Object.assign(a,y),_==1&&h==""&&setTimeout(function(){t.find(".tfhb-notice").append(__("Payment Method Required","hydra-booking")),t.find(".tfhb-notice").show(),t.find(".tfhb-booking-submit .tfhb-submit-preloader").remove()},2e3),(_!=1||_==1&&h=="woo_payment"||_==1&&h=="paypal_payment"||_==1&&h=="stripe_payment")&&$.ajax({url:tfhb_app_booking.ajax_url,type:"POST",action:"tfhb_meeting_form_submit",data:y,success:function(f){if(t.find(".tfhb-booking-submit .tfhb-submit-preloader").remove(),t.find(".tfhb-booking-submit").removeAttr("disabled"),f.success){if(t.find(".tfhb-booking-submit").remove(".tfhb-submit-preloader"),t.find(".tfhb-booking-submit").removeAttr("disabled"),_==1&&h=="paypal_payment"&&f.data.data){tfhb_render_paypal_payment(t,f.data);return}if(_==1&&h=="stripe_payment"&&f.data.data){tfhb_render_stripe_payment(t,f.data,b,l);return}if(f.data.redirect){window.location.href=f.data.redirect;return}else t.find(".tfhb-meeting-card").html(""),t.find(".tfhb-meeting-card").append(f.data.confirmation_template),f.data.action=="rescheduled"&&t.find(".tfhb-meeting-hostinfo").append(`
										   <div class="tfhb-notice " > 
										   <span>`+f.data.message+` </span>
									   </div>`)}else return t.find(".tfhb-notice").append(f.data.message),t.find(".tfhb-notice").show(),!1},error:function(f){console.log(f)}})}function tfhb_date_manipulate(t,e,a,n,r,l){const c=t.find(".tfhb-calendar-dates"),o=t.find(".tfhb-calendar-weekdays"),s=t.find(".tfhb-calendar-current-date");let d=e,m=d.availability,u=m.date_slots,p=m.time_slots;d.availability_range;let C=d.availability_range_type,j=d.availability_range.start,M=d.availability_range.end,w=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],v=[],N=tfhb_app_booking.general_settings.week_start_from||"Sunday",b=w.indexOf(N);b===-1&&(b=0);let x=[];for(let i=0;i<7;i++){let g=(b+i)%7;x.push(`<li>${tfhbTranslate(h[g])}</li>`)}o.html(x.join(""));for(let i=0;i<p.length;i++)(p[i].status===!1||p[i].status==!1)&&v.push(p[i].day);let y=(new Date(a,n,1).getDay()-b+7)%7,f=new Date(a,n+1,0).getDate(),L=(new Date(a,n,f).getDay()-b+7)%7,B=new Date(a,n,0).getDate(),D="";for(let i=y;i>0;i--)D+=`<li class="inactive">${tfhbTranslateNumber(B-i+1)}</li>`;for(let i=1;i<=f;i++){let g=i===r.getDate()&&n===new Date().getMonth()&&a===new Date().getFullYear()?"active":"",F=`${a}-${(n+1).toString().padStart(2,"0")}-${i.toString().padStart(2,"0")}`,z=typeof u<"u"?u.find(S=>S.date.match(F)):"",k=typeof z<"u"&&z!==""&&z.available===!0?"inactive ":" ",T="available";new Date>new Date(a,n,i)&&i!==r.getDate()&&(k="inactive ",T="unavailable");let I=w[new Date(a,n,i).getDay()];if(v.includes(I)&&(k="inactive ",T="unavailable",g=""),C!=="indefinitely"){let S=new Date(a,n,i);(S<new Date(j)||S>new Date(M))&&(k="inactive ",T="unavailable",g="")}g==="active"&&(k=" "),D+=`<li data-date="${F}" data-available="${T}" class="${g} current ${k}">${tfhbTranslateNumber(i)}</li>`}for(let i=L;i<6;i++)D+=`<li class="inactive">${tfhbTranslateNumber(i-L+1)}</li>`;s.text(`${tfhbTranslate(l[n])} ${tfhbTranslateNumber(a)}`),c.html(D)}function tfhb_times_manipulate(t,e,a,n=null){var r=t.find(".tfhb-calendar-dates li.active");t.find(".tfhb-available-times").addClass("inactive"),t.find(".tfhb-calendar-body").addClass("inactive");var l=t.find("input[name='meeting_id']").val(),c=e;r.attr("data-available");var o=t.find('input[name="tfhb_time_format"]:checked').val(),s=t.find(".tfhb-time-zone-select").val();$.ajax({url:tfhb_app_booking.ajax_url,type:"POST",data:{action:"tfhb_already_booked_times",nonce:tfhb_app_booking.nonce,selected_date:c,meeting_id:l,time_format:o,time_zone:s},success:function(d){d.success==!0&&(t.find(".tfhb-calendar-body").removeClass("inactive"),d.data,a.calander_available_time_slot=d.data,typeof n=="function"&&n()),d.success==!1&&(t.find(".tfhb-available-times").removeClass("inactive"),t.find(".tfhb-calendar-body").removeClass("inactive"),t.find(".tfhb-available-times").html(""),t.find(".tfhb-available-times").append("<ul></ul>"),t.find(".tfhb-available-times ul").append("<li > <p>"+d.data.message+"</p></li>"),t.find(".tfhb-meeting-times").css("display","block").animate({left:"0",opacity:1,width:224},400))},error:function(d){console.log(d)}})}})})(jQuery);
