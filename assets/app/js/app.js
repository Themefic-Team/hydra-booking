(function($){$(document).ready(function(){const tfhb_local_timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone,tfhb_i18n=tfhb_app_booking.i18n;function tfhbTranslate(t){return tfhb_i18n[t]||t+"not found"}function tfhbTranslateNumber(t){return t.toString().split("").map(function(e){return tfhbTranslate(e)}).join("")}function tfhbTranslateTimeSlot(t){return t.slice(6,8)!=""?tfhbTranslateNumber(t.slice(0,2))+":"+tfhbTranslateNumber(t.slice(3,5))+" "+tfhbTranslate(t.slice(6,8)):tfhbTranslateNumber(t.slice(0,2))+":"+tfhbTranslateNumber(t.slice(3,5))}$(document).on("click",".tfhb-timezone-tabs ul li",function(t){$(".tfhb-timezone-tabs ul li").removeClass("active");var e=$(this);e.addClass("active")}),$(".tfhb-meeting-box").each(function(){let $this=$(this),calenderId=$this.attr("data-calendar"),calenderData=eval("tfhb_app_booking_"+calenderId),preloader=`<div class="tfhb-preloader"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-linecap="round" fill="none" stroke-dasharray="51.83627878423159 51.83627878423159" stroke="#2e6b38" stroke-width="4" r="33" cy="50" cx="50">
				<animateTransform values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
			  </circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg></span></div>`,date=new Date,year=date.getFullYear(),month=date.getMonth();const tfhb_calendar_navs=$this.find(".tfhb-calendar-navigation span");console.log(tfhb_app_booking.i18n);const months=["January","February","March","April","May","June","July","August","September","October","November","December"];tfhb_date_manipulate($this,calenderData,year,month,date,months),tfhb_calendar_navs.each(function(){$(this).on("click",function(){month=$(this).attr("id")==="tfhb-calendar-prev"?month-1:month+1,month<0||month>11?(date=new Date(year,month,new Date().getDate()),year=date.getFullYear(),month=date.getMonth()):date=new Date,$this.find(".tfhb-meeting-times").animate({left:"-50%",width:0,opacity:0},300,function(){$(this).css("display","none")}),tfhb_date_manipulate($this,calenderData,year,month,date,months);var t=new Date(year,month,2).toISOString().split("T")[0];setTimeout(function(){tfhb_times_manipulate($this,t,calenderData)},1e3)})}),$($this).on("click",".tfhb-calendar-dates li",function(t){var e=$(this);if(e.hasClass("inactive"))return!1;$this.find(".tfhb-meeting-times").css("display","block").animate({left:"0%",opacity:1,width:224},400),$this.find(".tfhb-available-times").removeClass("inactive"),$this.find(".tfhb-available-times").html(""),$this.find(".tfhb-available-times").append("<ul></ul>");var a=e.attr("data-date");$this.find("#meeting_dates").val(a);var n=tfhbTranslate(new Date(a).toLocaleDateString("en-US",{weekday:"long"})),i=tfhbTranslate(new Date(a).toLocaleDateString("en-US",{month:"long"})),d=tfhbTranslateNumber(new Date(a).toLocaleDateString("en-US",{day:"numeric"})),c=n+", "+i+" "+d;$this.find(".tfhb-meeting-times .tfhb-select-date").html(c);var r=calenderData.calander_available_time_slot[a];if(r.length>0)for(var o=0;o<r.length;o++){var s="";r[o].remaining!=null&&(s='<span class="tfhb-time-slot-remaining tfhb-flexbox"><span></span>'+tfhbTranslateNumber(r[o].remaining)+" "+tfhbTranslate("seats left")+"</span>"),$this.find(".tfhb-available-times ul").append('<li class="tfhb-flexbox"> <div class="time" data-time-start="'+r[o].start+'" data-time-end="'+r[o].end+'">'+tfhbTranslateTimeSlot(r[o].start)+s+" </div> </li>")}else $this.find(".tfhb-available-times ul").append('<li class="tfhb-flexbox"> <div>No time slot available in this date ! Try another date.</span> </div>');$this.find(".tfhb-calendar-dates li").removeClass("active"),e.addClass("active")}),$this.find("#attendee_time_zone_"+calenderId).on("change",function(t){$this.find(".tfhb-meeting-times").animate({left:"-50%",width:0,opacity:0},300,function(){$(this).css("display","none")});var e=new Date(year,month,2).toISOString().split("T")[0];tfhb_times_manipulate($this,e,calenderData)}),$this.find('input[name="tfhb_time_format"]').on("change",function(t){var e=new Date(year,month,2).toISOString().split("T")[0];tfhb_times_manipulate($this,e,calenderData,function(){$this.find(".tfhb-calendar-dates li.active").trigger("click")})});const $timezoneSelect=$this.find("#attendee_time_zone_"+calenderId);$timezoneSelect.length&&($timezoneSelect.select2({dropdownCssClass:"tfhb-select2-dropdown"}),$timezoneSelect.val(tfhb_local_timeZone).trigger("change")),$($this).on("click",".tfhb-available-times li .time",function(t){$this_time=$(this),$(".tfhb-available-times li .time").removeClass("active"),$(".tfhb-available-times li .next").remove();var e=$this_time.attr("data-time-start"),a=$this_time.attr("data-time-end");$this.find("input[name='meeting_time_start']").val(e),$this.find("input[name='meeting_time_end']").val(a),$this_time.parent().append('<span class="next tfhb-flexbox tfhb-gap-8"> '+tfhbTranslate("Next")+'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 10L14 10" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 4.16666L14.8333 9.99999L9 15.8333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>'),$this_time.addClass("active")}),$($this).on("click",".tfhb-available-times li .next",function(t){var e=$this.find("#attendee_time_zone_"+calenderId).val(),a=$this.find("#meeting_dates").val(),n=$this.find("#meeting_time_start").val();$this.find("#meeting_time_end").val();var i=`<li class="tfhb-flexbox tfhb_time_zone_info tfhb-gap-8">
						<input type="hidden" id="recurring_maximum" name="recurring_maximum" value="' . esc_attr( $meeting['recurring_maximum'] ) . '">
						<div class="tfhb-icon">  
							<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
								<g clip-path="url(#clip0_1840_26071)">
									<path d="M8.00065 14.6667C11.6825 14.6667 14.6673 11.6819 14.6673 8.00001C14.6673 4.31811 11.6825 1.33334 8.00065 1.33334C4.31875 1.33334 1.33398 4.31811 1.33398 8.00001C1.33398 11.6819 4.31875 14.6667 8.00065 14.6667Z" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M8.00065 1.33334C6.28881 3.13078 5.33398 5.51784 5.33398 8.00001C5.33398 10.4822 6.28881 12.8692 8.00065 14.6667C9.71249 12.8692 10.6673 10.4822 10.6673 8.00001C10.6673 5.51784 9.71249 3.13078 8.00065 1.33334Z" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M1.33398 8H14.6673" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									</g>
									<defs>
									<clipPath id="clip0_1840_26071">
									<rect width="16" height="16" fill="white"/>
									</clipPath>
									</defs>
							</svg>
						</div> 
						<div>
							`+e+"("+tfhbTranslateTimeSlot(n)+`)
						</div>
					</li>`,d=new Date(a),c=tfhbTranslate(d.toLocaleDateString("en-US",{weekday:"long"})),r=tfhbTranslate(d.toLocaleDateString("en-US",{month:"long"})),o=tfhbTranslateNumber(d.toLocaleDateString("en-US",{day:"numeric"})),s=tfhbTranslateNumber(d.toLocaleDateString("en-US",{year:"numeric"})),m=c+", "+r+" "+o+", "+s,_=`<li class="tfhb-flexbox tfhb_date_time_info tfhb-gap-8">
						<input type="hidden" id="recurring_maximum" name="recurring_maximum" value="' . esc_attr( $meeting['recurring_maximum'] ) . '">
						<div class="tfhb-icon">  
							<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M5.33398 1.33334V4.00001" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M10.666 1.33334V4.00001" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M12.6667 2.66666H3.33333C2.59695 2.66666 2 3.26361 2 3.99999V13.3333C2 14.0697 2.59695 14.6667 3.33333 14.6667H12.6667C13.403 14.6667 14 14.0697 14 13.3333V3.99999C14 3.26361 13.403 2.66666 12.6667 2.66666Z" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M2 6.66666H14" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								<path d="M6 10.6667L7.33333 12L10 9.33334" stroke="#273F2B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</div> 
						<div>
							`+m+`
						</div>
					</li>`;$this.find(".tfhb-meeting-details ul").append(i),$this.find(".tfhb-meeting-details ul").append(_),$this.find(".tfhb-timezone").hide(),$this.find(".tfhb-meeting-times").animate({left:"-50%",width:0,opacity:0},300,function(){$(this).css("display","none")}),$this.find(".tfhb-calander-times").animate({left:"-5%",opacity:0},400,function(){$(this).css("display","none"),$this.find(".tfhb-meeting-booking-form").css("display","block").animate({left:"0",opacity:1,width:536},300)})}),$("span.tfhb-see-description").on("click",function(){$(".tfhb-short-description").slideUp(),$(".tfhb-full-description").slideDown()}),$("span.tfhb-see-less-description").on("click",function(){$(".tfhb-full-description").slideUp(),$(".tfhb-short-description").slideDown()}),$($this).on("click",".tfhb-meeting-booking-form .tfhb-back-btn",function(t){$this.find(".tfhb-meeting-booking-form").animate({left:"-5%",opacity:0},300,function(){$(this).css("display","none"),$this.find(".tfhb-timezone").show(),$this.find(".tfhb-calander-times").css("display","flex").animate({left:"0",opacity:1},200,function(){}),$this.find(".tfhb-meeting-times").css("display","block").animate({left:"0",width:224},400,function(){$(this).css("opacity","1"),$this.find(".tfhb-meeting-details ul .tfhb_time_zone_info").remove(),$this.find(".tfhb-meeting-details ul .tfhb_date_time_info").remove()})})}),$this.find(".tfhb-meeting-form.ajax-submit").on("submit",function(t){t.preventDefault();var e=new FormData(this),a={};e.forEach(function(n,i){a[i]=n}),tfhb_from_submission($this,preloader,a,calenderData)}),document.addEventListener("wpcf7mailsent",function(t){var e=t.detail.formData,a={};e.forEach(function(n,i){a[i]=n}),tfhb_from_submission($this,preloader,a,calenderData)}),$(document).on("forminator:form:submit:success",function(t,e){var a={};e.forEach(function(n,i){a[i]=n}),tfhb_from_submission($this,preloader,a,calenderData)}),$(document).on("fluentform_submission_success",function(t,e){var a=new FormData(e.form[0]),n={};a.forEach(function(i,d){n[d]=i}),tfhb_from_submission($this,preloader,n,calenderData)})});function tfhb_render_paypal_payment(t,e){t.find(".tfhb-paypal-button-container");var a=e.confirmation_template;t.find(".tfhb-confirmation-button").hide();let n=typeof tfhb_app_booking.general_settings.currency<"u"&&tfhb_app_booking.general_settings.currency!=""?tfhb_app_booking.general_settings.currency:"USD";paypal.Buttons({createOrder:function(i,d){return d.order.create({purchase_units:[{reference_id:e.data.attendee_data.id,description:e.data.meeting.title+" - "+e.data.meeting.duration+" Minutes | "+e.data.booking.start_time+" - "+e.data.booking.end_time+" | "+e.data.booking.meeting_dates,custom_id:e.data.attendee_data.id,amount:{currency_code:n,value:e.data.meeting.meeting_price}}]})},onApprove:function(i,d){return d.order.capture().then(function(c){$.ajax({url:tfhb_app_booking.ajax_url,type:"POST",data:{nonce:tfhb_app_booking.nonce,action:"tfhb_meeting_paypal_payment_confirmation",payment_details:c,responseData:e},success:function(r){r.success?(t.find(".tfhb-meeting-card").html(""),t.find(".tfhb-meeting-card").append(a)):(t.find(".tfhb-notice").html(r.data.message),t.find(".tfhb-notice").show())},error:function(r){console.log(r)}})})},onCancel:function(i){},onError:function(i){console.error("An error occurred during the transaction",i),alert("Payment could not be completed due to an error")}}).render(".tfhb-paypal-button-container")}function tfhb_render_stripe_payment(t,e,a,n){t.find(".tfhb-confirmation-button").hide();let i=typeof tfhb_app_booking.general_settings.currency<"u"&&tfhb_app_booking.general_settings.currency!=""?tfhb_app_booking.general_settings.currency:"USD";const d=t.find(".tfhb-stripe-button-container");d.html("<a href='#' class='tfhb-stripe-payment-btn'>Pay With Stripe</a>"),d.show();var c=e.confirmation_template;const r=StripeCheckout.configure({key:a,locale:"auto",token:function(o){const s={tokenId:o.id};jQuery.ajax({url:tfhb_app_booking.ajax_url,type:"POST",data:{nonce:tfhb_app_booking.nonce,action:"tfhb_meeting_stripe_payment_confirmation",payment_data:s,responseData:e},beforeSend:function(m){$(".tfhb-stripe-payment-btn").append(`<span class="tfhb-submit-preloader"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="188.49555921538757 64.83185307179586" r="40" stroke-width="4" stroke="#ffffff" fill="none" cy="50" cx="50">
							<animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="0.49751243781094534s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
						</circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg><span>`),$(".tfhb-stripe-payment-btn").addClass("disabled")},success:function(m){m.success?(t.find(".tfhb-meeting-card").html(""),t.find(".tfhb-meeting-card").append(c)):(t.find(".tfhb-notice").html(m.data.message),t.find(".tfhb-notice").show())},error:function(m){console.error("Payment processing error:",m)}})}});d.on("click",".tfhb-stripe-payment-btn",function(o){o.preventDefault(),r.open({name:n,amount:e.data.meeting.meeting_price*100,currency:i})}),window.addEventListener("popstate",function(){r.close()})}function tfhb_from_submission(t,e,a,n){t.find(".tfhb-booking-submit").append(`<span class="tfhb-submit-preloader"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="shape-rendering: auto; display: block; background: transparent;" width="200" height="200" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="188.49555921538757 64.83185307179586" r="40" stroke-width="4" stroke="#ffffff" fill="none" cy="50" cx="50">
			<animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="0.49751243781094534s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
		  </circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg><span>`),t.find(".tfhb-booking-submit").attr("disabled","disabled"),t.find(".tfhb-notice").hide(),t.find(".tfhb-notice").html("");var d=t.find(".tfhb-meeting-details h2").text(),c=t.find("#meeting_id").val(),r=t.find("#host_id").val(),o=t.find("#meeting_duration").val(),s=t.find("#meeting_dates").val(),m=t.find("#meeting_time_start").val(),_=t.find("#meeting_time_end").val(),w=t.find("#booking_hash").val(),x=t.find("#action_type").val(),v=t.find("#meeting_price").val(),D=t.find("#recurring_maximum").val(),T=t.find("#attendee_time_zone_"+n.meeting_id).val(),g=t.find("#tfhb_time_format").val();t.find("#name").val(),t.find("#email").val(),t.find("#address").val();var h=t.find("#payment_method").val(),v=t.find("#meeting_price").val(),y=t.find("#payment_amount").val(),u=t.find("#stpublic_key").val();t.find("#paypal_public_key").val();var S=t.find("#payment_currency").val(),b=n.payment_status,l={action:"tfhb_meeting_form_submit",nonce:tfhb_app_booking.nonce,meeting_id:c,host_id:r,meeting_dates:s,meeting_duration:o,meeting_time_start:m,meeting_time_end:_,booking_hash:w,action_type:x,recurring_maximum:D,attendee_time_zone:T,tfhb_time_format:g,payment_type:h,meeting_price:v,payment_amount:y,stripe_public_key:u,payment_currency:S};l=Object.assign(a,l),b==1&&h==""&&setTimeout(function(){t.find(".tfhb-notice").append(__("Payment Method Required","hydra-booking")),t.find(".tfhb-notice").show(),t.find(".tfhb-booking-submit .tfhb-submit-preloader").remove()},2e3),(b!=1||b==1&&h=="woo_payment"||b==1&&h=="paypal_payment"||b==1&&h=="stripe_payment")&&$.ajax({url:tfhb_app_booking.ajax_url,type:"POST",action:"tfhb_meeting_form_submit",data:l,success:function(f){if(t.find(".tfhb-booking-submit .tfhb-submit-preloader").remove(),t.find(".tfhb-booking-submit").removeAttr("disabled"),f.success){if(t.find(".tfhb-booking-submit").remove(".tfhb-submit-preloader"),t.find(".tfhb-booking-submit").removeAttr("disabled"),b==1&&h=="paypal_payment"&&f.data.data){tfhb_render_paypal_payment(t,f.data);return}if(b==1&&h=="stripe_payment"&&f.data.data){tfhb_render_stripe_payment(t,f.data,u,d);return}if(f.data.redirect){window.location.href=f.data.redirect;return}else t.find(".tfhb-meeting-card").html(""),t.find(".tfhb-meeting-card").append(f.data.confirmation_template),f.data.action=="rescheduled"&&t.find(".tfhb-meeting-hostinfo").append(`
										   <div class="tfhb-notice " > 
										   <span>`+f.data.message+` </span>
									   </div>`)}else return t.find(".tfhb-notice").append(f.data.message),t.find(".tfhb-notice").show(),!1},error:function(f){console.log(f)}})}function tfhb_date_manipulate(t,e,a,n,i,d){const c=t.find(".tfhb-calendar-dates"),r=t.find(".tfhb-calendar-current-date");let o=e,s=o.availability,m=s.date_slots,_=s.time_slots;o.availability_range;let w=o.availability_range_type,x=o.availability_range.start,D=o.availability_range.end,T=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=[];for(var h=0;h<_.length;h++)_[h].status==!1&&g.push(_[h].day);let v=new Date(a,n,1).getDay(),y=new Date(a,n+1,0).getDate(),u=new Date(a,n,y).getDay(),S=new Date(a,n,0).getDate(),b="";for(let l=v;l>0;l--)b+=`<li class="inactive">${tfhbTranslateNumber(S-l+1)}</li>`;for(let l=1;l<=y;l++){let f=l===i.getDate()&&n===new Date().getMonth()&&a===new Date().getFullYear()?"active":"",M=a+"-"+(n+1).toString().padStart(2,"0")+"-"+l.toString().padStart(2,"0"),C=typeof m<"u"?m.find(j=>j.date.match(M)):"",p=typeof C<"u"&&C!==""&&C.available==!0?"inactive ":" ",k="available";new Date>new Date(a,n,l)&&l!==i.getDate()&&(p="inactive ",k="unavailable"),g.includes(T[new Date(a,n,l).getDay()])&&(p="inactive ",k="unavailable"),w!="indefinitely"&&(new Date(a,n,l)<new Date(x)||new Date(a,n,l)>new Date(D))&&(p="inactive ",k="unavailable",f=""),f=="active"&&(p=" "),b+=`<li data-date="${M}" data-available="${k}" class="${f} current ${p}">${tfhbTranslateNumber(l)}</li>`}for(let l=u;l<6;l++)b+=`<li class="inactive">${tfhbTranslateNumber(l-u+1)}</li>`;r.text(`${tfhbTranslate(d[n])} ${tfhbTranslateNumber(a)}`),c.html(b)}function tfhb_times_manipulate(t,e,a,n=null){var i=t.find(".tfhb-calendar-dates li.active");t.find(".tfhb-available-times").addClass("inactive"),t.find(".tfhb-calendar-body").addClass("inactive");var d=t.find("input[name='meeting_id']").val(),c=e;i.attr("data-available");var r=t.find('input[name="tfhb_time_format"]:checked').val(),o=t.find(".tfhb-time-zone-select").val();$.ajax({url:tfhb_app_booking.ajax_url,type:"POST",data:{action:"tfhb_already_booked_times",nonce:tfhb_app_booking.nonce,selected_date:c,meeting_id:d,time_format:r,time_zone:o},success:function(s){s.success==!0&&(t.find(".tfhb-calendar-body").removeClass("inactive"),s.data,a.calander_available_time_slot=s.data,typeof n=="function"&&n()),s.success==!1&&(t.find(".tfhb-available-times").removeClass("inactive"),t.find(".tfhb-calendar-body").removeClass("inactive"),t.find(".tfhb-available-times").html(""),t.find(".tfhb-available-times").append("<ul></ul>"),t.find(".tfhb-available-times ul").append("<li > <p>"+s.data.message+"</p></li>"),t.find(".tfhb-meeting-times").css("display","block").animate({left:"0",opacity:1,width:224},400))},error:function(s){console.log(s)}})}})})(jQuery);
